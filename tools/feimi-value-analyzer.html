<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>飞米积分价值观分析器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .input-section {
            margin-bottom: 40px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 1.1em;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .form-textarea:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .analyze-btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            width: 100%;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }

        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .result-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e5e7eb;
        }

        .result-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .result-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #374151;
            margin-right: 15px;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e5e7eb;
            border-top: 2px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-content {
            background: #f8fafc;
            border-radius: 8px;
            padding: 25px;
            border: 1px solid #e2e8f0;
            min-height: 100px;
            font-size: 1.05em;
            line-height: 1.6;
            color: #374151;
        }

        .result-content h1, .result-content h2, .result-content h3 {
            color: #1f2937;
            margin-top: 20px;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .result-content h1 {
            font-size: 1.5em;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 8px;
        }

        .result-content h2 {
            font-size: 1.3em;
            color: #4f46e5;
        }

        .result-content h3 {
            font-size: 1.2em;
            color: #6366f1;
        }

        .result-content strong {
            font-weight: 600;
            color: #1f2937;
        }

        .result-content em {
            font-style: italic;
            color: #6b7280;
        }

        .result-content p {
            margin-bottom: 12px;
        }

        .result-content ul, .result-content ol {
            margin-left: 20px;
            margin-bottom: 12px;
        }

        .result-content li {
            margin-bottom: 6px;
        }

        .result-content code {
            background: #e5e7eb;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .result-content blockquote {
            border-left: 4px solid #4f46e5;
            padding-left: 15px;
            margin: 12px 0;
            font-style: italic;
            color: #6b7280;
        }

        .highlight-rule {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: 600;
            display: inline-block;
            margin: 8px 0;
        }

        .case-content {
            background: #fff;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .category-tag {
            display: inline-block;
            background: #f3f4f6;
            color: #4b5563;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            margin-left: 8px;
            font-weight: 500;
        }

        .category-tag.坦率真诚 { background: #dbeafe; color: #1e40af; }
        .category-tag.开放协作 { background: #d1fae5; color: #059669; }
        .category-tag.承诺敢为 { background: #fed7d7; color: #c53030; }
        .category-tag.尊重谦逊 { background: #f3e8ff; color: #7c3aed; }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s ease;
            display: none;
        }

        .copy-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
        }

        .copy-btn:active {
            transform: translateY(0);
        }

        .copy-btn.copied {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        }

        .result-section {
            position: relative;
        }

        .result-empty {
            text-align: center;
            color: #6b7280;
            font-style: italic;
        }

        .typing-cursor {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .value-badge {
            display: inline-block;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 20px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>飞米积分价值观分析器</h1>
            <p>基于事件文本智能匹配价值观准则，生成行为案例和推荐理由</p>
        </div>
        
        <div class="main-content">
            <div class="input-section">
                <div class="form-group">
                    <label for="eventText" class="form-label">请输入事件文本：</label>
                    <textarea 
                        id="eventText" 
                        class="form-textarea" 
                        placeholder="请详细描述发生的事件，包括时间、地点、人物、具体行为等信息，系统将基于这些信息分析最符合的价值观准则..."
                    ></textarea>
                </div>
                <button id="analyzeBtn" class="analyze-btn">
                    分析价值观匹配
                </button>
            </div>
            
            <div class="result-section">
                <div class="result-header">
                    <h3 class="result-title">分析结果</h3>
                    <div id="loadingSpinner" class="loading-spinner"></div>
                </div>
                <button id="copyBtn" class="copy-btn">📋 复制结果</button>
                <div id="resultContent" class="result-content">
                    <div class="result-empty">
                        请输入事件文本并点击分析按钮，系统将为您匹配最适合的价值观准则
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://api.deepseek.com/v1/chat/completions';
        const API_KEY = 'sk-08fd0b2b32284162bad21e12b9f07c14';

        const valueRules = {
            'C1': { name: '绝对坦率', purpose: '建立坦诚高效的沟通文化', behaviors: ['主动发起争议对话', '高效化解分歧'] },
            'C2': { name: '信息透明', purpose: '实现关键信息无损传递', behaviors: ['信息无衰减传递', '风险即时上报'] },
            'C3': { name: '问题驱动', purpose: '建立系统性解决问题能力', behaviors: ['快速响应', '根治问题'] },
            'C4': { name: '言行一致', purpose: '打造可信赖的组织承诺', behaviors: ['承诺匹配进度', '表述一致'] },
            'C5': { name: '事实导向', purpose: '实现数据驱动的科学决策', behaviors: ['数据决策', '可测量结果'] },
            'C6': { name: '信息共享', purpose: '最大化知识资产价值', behaviors: ['知识沉淀', '信息保鲜'] },
            'C7': { name: '知识复用', purpose: '提升经验迁移效率', behaviors: ['经验适配', '高效转化'] },
            'C8': { name: '成长透明', purpose: '加速个人与组织进化', behaviors: ['需求可见', '互助响应'] },
            'C9': { name: '团队共赢', purpose: '构建协同增效的生态系统', behaviors: ['价值创造', '体验优化'] },
            'C10': { name: '跨团队创新', purpose: '激发跨界创新价值', behaviors: ['边界突破', '资源杠杆'] },
            'C11': { name: '目标韧性', purpose: '锻造抗压适应能力', behaviors: ['抗压执行', '动态适应'] },
            'C12': { name: '超预期交付', purpose: '创造持续价值溢出', behaviors: ['价值增值', '峰值体验'] },
            'C13': { name: '理性拒绝', purpose: '聚焦战略价值区', behaviors: ['战略定力', '提供替代方案'] },
            'C14': { name: '创新回报', purpose: '实现风险调整收益', behaviors: ['风险对冲', '失败转化'] },
            'C15': { name: '突破性尝试', purpose: '推动可控边界突破', behaviors: ['可控冒险', '极限学习'] },
            'C16': { name: '多维尊重', purpose: '建立深度互信生态', behaviors: ['文化共识', '角色体验'] },
            'C17': { name: '包容进化', purpose: '打造多样性创新土壤', behaviors: ['多元决策', '心理安全'] },
            'C18': { name: '谦逊成长', purpose: '加速短板转化', behaviors: ['缺口披露', '知识辐射'] },
            'C19': { name: '智慧沟通', purpose: '提升沟通转化效率', behaviors: ['信息增值', '情绪生产'] },
            'C20': { name: '冲突价值', purpose: '将冲突转化为升级动能', behaviors: ['矛盾转化', '文化免疫'] }
        };

        const eventTextArea = document.getElementById('eventText');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const resultContent = document.getElementById('resultContent');
        const copyBtn = document.getElementById('copyBtn');

        let originalContent = ''; // 存储原始内容用于复制

        analyzeBtn.addEventListener('click', analyzeEvent);
        copyBtn.addEventListener('click', copyResult);

        async function analyzeEvent() {
            const eventText = eventTextArea.value.trim();
            
            if (!eventText) {
                showError('请输入事件文本');
                return;
            }

            setLoading(true);
            currentContent = '';
            originalContent = '';
            copyBtn.style.display = 'none';
            resultContent.innerHTML = '<span class="typing-cursor">|</span>';

            try {
                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: `你是一个价值观匹配专家。根据提供的事件文本，从以下20个价值观准则中选择最匹配的1-2个，并生成对应的行为案例。

价值观准则信息和大分类：

**坦率真诚（C1-C5）：**
C1-绝对坦率：主动发起争议对话、高效化解分歧
C2-信息透明：信息无衰减传递、风险即时上报  
C3-问题驱动：快速响应、根治问题
C4-言行一致：承诺匹配进度、表述一致
C5-事实导向：数据决策、可测量结果

**开放协作（C6-C10）：**
C6-信息共享：知识沉淀、信息保鲜
C7-知识复用：经验适配、高效转化
C8-成长透明：需求可见、互助响应
C9-团队共赢：价值创造、体验优化
C10-跨团队创新：边界突破、资源杠杆

**承诺敢为（C11-C15）：**
C11-目标韧性：抗压执行、动态适应
C12-超预期交付：价值增值、峰值体验
C13-理性拒绝：战略定力、提供替代方案
C14-创新回报：风险对冲、失败转化
C15-突破性尝试：可控冒险、极限学习

**尊重谦逊（C16-C20）：**
C16-多维尊重：文化共识、角色体验
C17-包容进化：多元决策、心理安全
C18-谦逊成长：缺口披露、知识辐射
C19-智慧沟通：信息增值、情绪生产
C20-冲突价值：矛盾转化、文化免疫

重要要求：
1. 请基于事件文本中的具体行为和结果来分析，不要基于请求或需求本身
2. 行为案例必须详细描述具体发生的行为过程和产生的积极影响
3. 案例长度控制在50-80字，要体现行为的完整闭环
4. 重点关注被认可人员的具体行动和贡献
5. 语言风格要求：使用自然但不失专业的表述，避免过于正式的商业化用词
   - 用"帮助"而不是"协助"或"帮忙"
   - 用"完成了"而不是"搞定了"
   - 用"快速"而不是"迅速"
   - 用"理清了"而不是"明确了"
   - 可以使用"然后"、"接着"等自然连接词
   - 避免"立即"、"迅速"、"高效"等过于正式的词汇

行为案例示例参考：
- 好的表述："小王接到需求后，快速帮助我们理清了整个流程，然后还制作了文档分享给团队，很有帮助"
- 避免的表述："王某收到需求后，迅速协助团队明确了流程规范，并制作了详细文档供团队成员参考"

请严格按照以下简洁格式输出：

**对应准则编号**
[大分类] - C[数字] [准则名称]
（如果匹配多个准则，可以列出多个，如：开放协作 - C8 成长透明、开放协作 - C9 团队共赢）

**对应行为案例：**
[详细描述具体发生的行为过程，包括采取的行动、方法、过程和产生的积极结果，50-80字，用研发人员日常口语化表述]`
                            },
                            {
                                role: 'user',
                                content: `请分析以下事件文本，匹配最符合的价值观准则：\n\n${eventText}`
                            }
                        ],
                        stream: true
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                resultContent.innerHTML = '';

                while (true) {
                    const { value, done } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = line.slice(6);
                            if (data === '[DONE]') continue;
                            
                            try {
                                const parsed = JSON.parse(data);
                                const delta = parsed.choices?.[0]?.delta?.content;
                                if (delta) {
                                    originalContent += delta;
                                    await typeWriter(resultContent, delta);
                                }
                            } catch (e) {
                                console.error('Error parsing SSE data:', e);
                            }
                        }
                    }
                }

                setLoading(false);
                if (originalContent.trim()) {
                    copyBtn.style.display = 'block';
                }

            } catch (error) {
                console.error('Error:', error);
                setLoading(false);
                showError('分析过程中出现错误，请检查网络连接或API配置');
            }
        }

        async function copyResult() {
            if (!originalContent.trim()) {
                showError('没有可复制的内容');
                return;
            }

            try {
                // 处理原始内容，转换为纯文本格式
                let copyText = originalContent
                    // 去除大分类标签，只保留准则编号和名称
                    .replace(/(坦率真诚|开放协作|承诺敢为|尊重谦逊)\s*-\s*(C\d+\s+[^\n]+)/g, '$2')
                    // 去除markdown格式标记
                    .replace(/\*\*(.*?)\*\*/g, '$1')  // 去除粗体标记
                    .replace(/\*(.*?)\*/g, '$1')      // 去除斜体标记
                    .replace(/`(.*?)`/g, '$1')        // 去除代码标记
                    .replace(/^#+\s*/gm, '')          // 去除标题标记
                    // 清理多余的空行
                    .replace(/\n\s*\n\s*\n/g, '\n\n')
                    .trim();

                await navigator.clipboard.writeText(copyText);
                
                // 显示复制成功状态
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '✅ 已复制';
                copyBtn.classList.add('copied');
                
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.classList.remove('copied');
                }, 2000);
                
            } catch (err) {
                console.error('复制失败:', err);
                showError('复制失败，请手动选择内容复制');
            }
        }

        function parseMarkdown(text) {
            let html = text;
            
            // Headers
            html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');
            
            // Bold text
            html = html.replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>');
            
            // Italic text
            html = html.replace(/\*(.*?)\*/gim, '<em>$1</em>');
            
            // Code blocks
            html = html.replace(/`(.*?)`/gim, '<code>$1</code>');
            
            // Line breaks
            html = html.replace(/\n/gim, '<br>');
            
            // Format category tags for value rules (category first)
            html = html.replace(/(坦率真诚|开放协作|承诺敢为|尊重谦逊)\s+-\s+(C\d+\s+[^\n<]+)/gim, 
                '<span class="category-tag $1">$1</span> - $2');
            
            // Wrap case content
            html = html.replace(/(\*\*对应行为案例：\*\*<br>)(.*?)(?=<br><br>|$)/gims, '$1<div class="case-content">$2</div>');
            
            return html;
        }

        let currentContent = '';
        
        async function typeWriter(element, text) {
            return new Promise((resolve) => {
                let i = 0;
                const speed = 30;
                
                function type() {
                    if (i < text.length) {
                        currentContent += text.charAt(i);
                        element.innerHTML = parseMarkdown(currentContent);
                        i++;
                        setTimeout(type, speed);
                    } else {
                        resolve();
                    }
                }
                type();
            });
        }

        function setLoading(loading) {
            analyzeBtn.disabled = loading;
            loadingSpinner.style.display = loading ? 'block' : 'none';
            
            if (loading) {
                analyzeBtn.textContent = '分析中...';
            } else {
                analyzeBtn.textContent = '分析价值观匹配';
            }
        }

        function showError(message) {
            resultContent.innerHTML = `
                <div class="error-message">
                    <strong>错误：</strong> ${message}
                </div>
            `;
        }

        eventTextArea.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                analyzeEvent();
            }
        });
    </script>
</body>
</html>